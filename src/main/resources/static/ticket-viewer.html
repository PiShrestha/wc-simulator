<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Ticket Explorer</title>
    <style>
      :root {
        color-scheme: light dark;
        --bg: #0f172a;
        --panel: #111827;
        --panel-alt: #0b1223;
        --border: #1f2937;
        --accent: #22c55e;
        --text: #e5e7eb;
        --muted: #9ca3af;
        --card: #0f172a;
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        background: var(--bg);
        color: var(--text);
        font-family: "Inter", "Segoe UI", system-ui, -apple-system, sans-serif;
        min-height: 100vh;
      }
      a {
        color: inherit;
      }
      .shell {
        max-width: 1200px;
        margin: 0 auto;
        padding: 24px 16px 48px;
      }
      header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 12px;
        flex-wrap: wrap;
        margin-bottom: 16px;
      }
      .title {
        font-size: 28px;
        margin: 0 0 4px;
      }
      .subtitle {
        color: var(--muted);
        margin: 0;
        font-size: 14px;
      }
      .layout {
        display: grid;
        grid-template-columns: 280px 1fr;
        gap: 16px;
        align-items: start;
      }
      @media (max-width: 960px) {
        .layout {
          grid-template-columns: 1fr;
        }
      }
      .panel {
        background: var(--panel);
        border: 1px solid var(--border);
        border-radius: 14px;
        padding: 16px;
        box-shadow: 0 12px 30px rgba(0, 0, 0, 0.28);
      }
      .venue-list {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }
      .venue-btn {
        border: 1px solid var(--border);
        background: var(--panel-alt);
        color: var(--text);
        padding: 10px 12px;
        border-radius: 12px;
        text-align: left;
        cursor: pointer;
        transition: border-color 120ms ease, transform 120ms ease;
      }
      .venue-btn:hover,
      .venue-btn:focus-visible {
        border-color: var(--accent);
        transform: translateY(-1px);
      }
      .venue-btn.active {
        border-color: var(--accent);
        box-shadow: 0 0 0 1px rgba(34, 197, 94, 0.5);
      }
      .venue-name {
        font-weight: 700;
        display: block;
      }
      .venue-meta {
        color: var(--muted);
        font-size: 12px;
        margin-top: 2px;
      }
      .matches-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
        gap: 12px;
      }
      .match-card {
        position: relative;
        border: 1px solid var(--border);
        background: var(--card);
        border-radius: 14px;
        padding: 14px 14px 44px;
        min-height: 150px;
        overflow: hidden;
        transition: border-color 120ms ease, transform 120ms ease;
      }
      .match-card:hover,
      .match-card:focus-within {
        border-color: var(--accent);
        transform: translateY(-2px);
      }
      .match-id {
        font-size: 12px;
        text-transform: uppercase;
        color: var(--accent);
        font-weight: 700;
        letter-spacing: 0.06em;
      }
      .match-meta {
        color: var(--muted);
        font-size: 13px;
        margin: 4px 0 8px;
      }
      .teams {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
      }
      .team-pill {
        background: var(--panel-alt);
        border: 1px solid var(--border);
        padding: 6px 10px;
        border-radius: 999px;
        font-weight: 600;
        font-size: 12px;
      }
      .vs {
        color: var(--muted);
        font-weight: 700;
        font-size: 11px;
      }
      .tooltip {
        position: absolute;
        left: 10px;
        right: 10px;
        bottom: 10px;
        padding: 10px 12px;
        background: rgba(8, 47, 22, 0.92);
        border: 1px solid rgba(34, 197, 94, 0.45);
        border-radius: 12px;
        box-shadow: 0 12px 30px rgba(0, 0, 0, 0.35);
        color: #d1fae5;
        opacity: 0;
        transform: translateY(6px);
        pointer-events: none;
        transition: opacity 120ms ease, transform 120ms ease;
        backdrop-filter: blur(4px);
      }
      .match-card:hover .tooltip,
      .match-card:focus-within .tooltip {
        opacity: 1;
        transform: translateY(0);
      }
      .tooltip-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 13px;
      }
      .tooltip-row + .tooltip-row {
        margin-top: 6px;
      }
      .tooltip-label {
        font-weight: 700;
      }
      .tooltip-price {
        font-weight: 800;
      }
      .empty {
        color: var(--muted);
        font-size: 14px;
      }
    </style>
  </head>
  <body>
    <div class="shell">
      <header>
        <div>
          <p class="subtitle">World Cup Ticket Explorer</p>
          <h1 class="title">Pick a venue, hover to reveal prices</h1>
          <p class="subtitle">
            Only Category 1–3 prices are shown on hover. All data is read from
            tickets.json.
          </p>
        </div>
        <a href="/" class="subtitle" style="text-decoration: none">← Back</a>
      </header>

      <div class="layout">
        <aside class="panel" aria-label="Venues">
          <h2 style="margin-top: 0; margin-bottom: 10px; font-size: 16px">
            Venues
          </h2>
          <div id="venueList" class="venue-list" role="list"></div>
        </aside>

        <main class="panel" aria-label="Matches">
          <div
            style="
              display: flex;
              justify-content: space-between;
              align-items: center;
              gap: 10px;
              margin-bottom: 10px;
              flex-wrap: wrap;
            "
          >
            <div>
              <p class="subtitle" id="activeVenueHint">Select a venue</p>
              <h2 id="activeVenueLabel" style="margin: 4px 0 0">&nbsp;</h2>
            </div>
            <a
              href="tickets.json"
              class="subtitle"
              style="text-decoration: none"
              >Download JSON</a
            >
          </div>
          <div id="matches" class="matches-grid"></div>
        </main>
      </div>
    </div>

    <script>
      const venueListEl = document.getElementById("venueList");
      const matchesEl = document.getElementById("matches");
      const activeVenueLabel = document.getElementById("activeVenueLabel");
      const activeVenueHint = document.getElementById("activeVenueHint");
      let allMatches = [];
      let activeVenue = null;

      fetch("./tickets.json")
        .then((res) => res.json())
        .then((data) => {
          allMatches = Array.isArray(data) ? data : [];
          const venues = Array.from(
            new Set(allMatches.map((m) => m.stadium))
          ).sort();
          renderVenues(venues);
          if (venues.length) selectVenue(venues[0]);
        })
        .catch((err) => {
          activeVenueLabel.textContent = "Error loading tickets.json";
          activeVenueHint.textContent = err.message || "";
        });

      function renderVenues(venues) {
        venueListEl.innerHTML = "";
        venues.forEach((venue) => {
          const btn = document.createElement("button");
          btn.type = "button";
          btn.className = "venue-btn";
          btn.innerHTML = `<span class="venue-name">${venue}</span>`;
          const count = allMatches.filter((m) => m.stadium === venue).length;
          const meta = document.createElement("span");
          meta.className = "venue-meta";
          meta.textContent = `${count} match${count === 1 ? "" : "es"}`;
          btn.append(meta);
          btn.addEventListener("click", () => selectVenue(venue));
          venueListEl.append(btn);
        });
      }

      function selectVenue(venue) {
        activeVenue = venue;
        activeVenueLabel.textContent = venue;
        activeVenueHint.textContent =
          "Hover a match card to reveal Category 1–3 prices.";
        Array.from(venueListEl.children).forEach((child) => {
          child.classList.toggle(
            "active",
            child.querySelector(".venue-name").textContent === venue
          );
        });
        renderMatches();
      }

      function renderMatches() {
        matchesEl.innerHTML = "";
        const scoped = allMatches.filter((m) => m.stadium === activeVenue);
        if (!scoped.length) {
          const empty = document.createElement("p");
          empty.className = "empty";
          empty.textContent = "No matches for this venue.";
          matchesEl.append(empty);
          return;
        }
        scoped.sort((a, b) => (a.match || 0) - (b.match || 0));
        scoped.forEach((match) => matchesEl.append(buildMatchCard(match)));
      }

      function buildMatchCard(match) {
        const card = document.createElement("article");
        card.className = "match-card";
        card.tabIndex = 0;

        const id = document.createElement("div");
        id.className = "match-id";
        id.textContent = `Match ${match.match ?? ""}`;

        const meta = document.createElement("div");
        meta.className = "match-meta";
        const date = match.date || "TBD";
        const time = match.time || "";
        const stadium = match.stadium || "";
        meta.textContent = `${date}${time ? " · " + time : ""}${
          stadium ? " · " + stadium : ""
        }`;

        const teams = document.createElement("div");
        teams.className = "teams";
        const list = Array.isArray(match.teams) ? match.teams : [];
        list.forEach((team, idx) => {
          const pill = document.createElement("span");
          pill.className = "team-pill";
          pill.textContent = team;
          teams.append(pill);
          if (idx === 0 && list.length > 1) {
            const vs = document.createElement("span");
            vs.className = "vs";
            vs.textContent = "vs";
            teams.append(vs);
          }
        });

        const tooltip = buildTooltip(match.tickets || {});

        card.append(id, meta, teams, tooltip);
        return card;
      }

      function buildTooltip(tickets) {
        const tooltip = document.createElement("div");
        tooltip.className = "tooltip";
        const cats = ["Category 1", "Category 2", "Category 3"];
        cats.forEach((cat) => {
          tooltip.append(priceRow(cat, tickets[cat]));
        });
        return tooltip;
      }

      function priceRow(label, value) {
        const row = document.createElement("div");
        row.className = "tooltip-row";
        const l = document.createElement("span");
        l.className = "tooltip-label";
        l.textContent = label;
        const p = document.createElement("span");
        p.className = "tooltip-price";
        p.textContent = formatPrice(value);
        row.append(l, p);
        return row;
      }

      function formatPrice(val) {
        if (val === undefined || val === null || Number.isNaN(Number(val)))
          return "Not listed";
        return new Intl.NumberFormat("en-US", {
          style: "currency",
          currency: "USD",
          minimumFractionDigits: 0,
          maximumFractionDigits: 2,
        }).format(Number(val));
      }
    </script>
  </body>
</html>
